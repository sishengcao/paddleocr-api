# 快速开始指南

本指南提供详细的部署步骤，帮助您快速启动 PaddleOCR API 服务。

---

## 目录

- [Windows 部署](#windows-部署)
- [Linux/WSL 部署](#linuxwsl-部署)
- [Docker Compose 部署](#docker-compose-部署推荐)
- [验证部署](#验证部署)

---

## Windows 部署

### 仅单个识别功能

1. **安装 Python 3.8+**

下载地址：https://www.python.org/downloads/

2. **克隆项目**

```bash
git clone https://github.com/sishengcao/paddleocr-api.git
cd paddleocr-api
```

3. **安装依赖**

```bash
# 创建虚拟环境
python -m venv venv

# 激活虚拟环境
venv\Scripts\activate

# 安装依赖
pip install -r requirements.txt
```

4. **启动服务**

```bash
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000
```

5. **访问服务**

- API 文档：http://localhost:8000/docs
- Web 界面：http://localhost:8000/

---

## Linux/WSL 部署

### 仅单个识别功能

1. **安装 Python 3.8+**

```bash
# Ubuntu/Debian
sudo apt update
sudo apt install -y python3 python3-pip python3-venv

# CentOS/RHEL
sudo yum install -y python3 python3-pip
```

2. **克隆项目**

```bash
git clone https://github.com/sishengcao/paddleocr-api.git
cd paddleocr-api
```

3. **安装依赖**

```bash
# 创建虚拟环境
python3 -m venv venv

# 激活虚拟环境
source venv/bin/activate

# 安装依赖
pip install -r requirements.txt
```

4. **启动服务**

```bash
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000
```

### 完整功能（单个识别 + 批量扫描）

#### 1. 安装依赖服务

**MySQL**

```bash
# Ubuntu/Debian
sudo apt install -y mysql-server

# CentOS/RHEL
sudo yum install -y mysql-server

# 启动 MySQL
sudo systemctl start mysql
sudo systemctl enable mysql
```

**Redis**

```bash
# Ubuntu/Debian
sudo apt install -y redis-server

# CentOS/RHEL
sudo yum install -y redis

# 启动 Redis
sudo systemctl start redis
sudo systemctl enable redis
```

#### 2. 配置环境变量

```bash
cp .env.example .env
vim .env  # 修改数据库连接信息
```

关键配置项：
```bash
# 数据库配置
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=your_password
DB_NAME=paddleocr_api

# Redis 配置
REDIS_HOST=localhost
REDIS_PORT=6379
```

#### 3. 初始化数据库

```bash
# 创建数据库
mysql -u root -p -e "CREATE DATABASE paddleocr_api CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"

# 导入表结构
mysql -u root -p paddleocr_api < migrations/001_initial_schema.sql
```

#### 4. 启动服务

```bash
# 启动 API 服务
source venv/bin/activate
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000

# 启动 Celery Worker（新终端）
source venv/bin/activate
celery -A app.workers.celery_worker worker --loglevel=info --concurrency=4
```

#### 5. 验证服务

```bash
# 检查 API 健康状态
curl http://localhost:8000/api/ocr/health

# 查看日志
tail -f logs/api.log
```

---

## Docker Compose 部署（推荐）

> **要求**: Docker Compose v2（检查版本：`docker compose version`）
>
> **遇到问题？** 查看 [部署故障排查](部署故障排查.md) 获取详细解决方案

### 前置准备

```bash
# 安装 Docker
curl -fsSL https://get.docker.com | sh

# 安装 Docker Compose v2
# 参考 https://docs.docker.com/compose/install/
```

### 部署步骤

```bash
# 前置要求：Docker Compose v2
# 检查版本：docker compose version

# 1. 克隆项目
git clone https://github.com/sishengcao/paddleocr-api.git
cd paddleocr-api

# 2. 创建环境变量文件
cp .env.example .env
# 如果 .env.example 不存在，手动创建 .env 文件，参考下方配置

# 3. (可选) 配置 Docker 镜像加速器
# 如果拉取镜像失败，执行以下命令：
sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json > /dev/null << 'EOF'
{
  "registry-mirrors": [
    "https://docker.1panel.live",
    "https://docker.xuanyuan.me"
  ]
}
EOF
sudo systemctl daemon-reload
sudo systemctl restart docker

# 4. 启动所有服务
docker compose up -d

# 5. 查看日志
docker compose logs -f

# 6. 查看服务状态
docker compose ps

# 7. 停止服务
docker compose down
```

### 环境变量配置

如果 `.env.example` 不存在，手动创建 `.env` 文件：

```bash
# 应用配置
APP_NAME=PaddleOCR API
APP_VERSION=2.0.0
DEBUG=false
LOG_LEVEL=INFO

# 服务器配置
HOST=0.0.0.0
PORT=8000
WORKERS=4

# 数据库配置
DB_HOST=mysql
DB_PORT=3306
DB_USER=root
DB_PASSWORD=!qwert
DB_NAME=paddleocr_api

# Redis 配置
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=

# OCR 配置
OCR_LANG=ch
OCR_USE_GPU=false
OCR_USE_ANGLE_CLS=true
```

### 服务架构

| 服务 | 端口 | 说明 |
|------|------|------|
| paddleocr-api | 8000 | API 服务 |
| mysql | 3306 | MySQL 数据库 |
| redis | 6379 | Redis 缓存 |
| celery-worker | - | Celery 任务处理器 |
| celery-beat | - | Celery 定时任务 |

---

## 验证部署

### 检查服务状态

```bash
# 检查 API 健康状态
curl http://localhost:8000/api/ocr/health

# 预期响应
{"status":"healthy","version":"1.0.0"}
```

### 查看 API 文档

访问 http://localhost:8000/docs 查看 Swagger UI 文档。

### 测试识别功能

```bash
# 上传图片测试
curl -X POST "http://localhost:8000/api/ocr/recognize" \
  -F "file=@test.jpg" \
  -F "lang=ch"
```

---

## 下一步

- 查看 [API 使用指南](API使用指南.md) 了解 API 详细用法
- 查看 [配置说明](配置说明.md) 了解配置项
- 查看 [常见问题](常见问题.md) 解决部署问题
- 查看 [部署故障排查](部署故障排查.md) 处理复杂部署问题
